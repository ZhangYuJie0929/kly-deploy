---
- name: Ensuring btserver config directories exist
  file:
    path: "{{ config_directory }}/btserver"
    state: "directory"
    mode: "0775"
  become: true

- name: Cat mgmt network ip
  shell: cat /etc/sysconfig/network-scripts/ifcfg-{{ api_interface }} | grep IPADDR | egrep -v {{ inventory_hostname }} | awk -F'=' '{print $2}'
  register: manage_ip

- name: set manage_ip
  set_fact:
    ext_manage_ip: "{{ manage_ip.stdout }}"

- name: copy opentracker.conf conf file
  template:
    src: opentracker.conf.j2
    dest: "{{ config_directory }}/btserver/opentracker.conf"

- name: copy torrent.ini conf file
  template:
    src: torrent.ini.j2
    dest: "{{ config_directory }}/btserver/torrent.ini"
  notify: 
    - Restart btserver container
    - Restart btserver_tracker container
